<!DOCTYPE html>
<html lang="eng">
<head>
  <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>payment</title>
</head>
<body>
  <h2>결제 페이지</h2>

  <!--총 금액과 할인 정보가 표시될 영역-->
  <div id="info"></div>
  
  <!--쿠폰 안내 및 버튼 삽입 영역-->
  <div id="coupon"></div>

  <br>
  
  <!--결제 방법 선택 영역-->
  <div>
<!--"radio" : 라디오 버튼, 결제 방법 중 중복x 하나만 고를 수 있게끔 설정-->
<!--name="pay" : 같은 그룹으로 묶어서 하나만 설정할 수 있게끔 설정-->
    <label>결제 방법 선택:</label><br>
    <input type="radio" name="pay" value="card"> 카드
    <input type="radio" name="pay" value="kakao"> 카카오페이
    <input type="radio" name="pay" value="naver"> 네이버페이
  </div>

  <br>

  <!-- 결제 및 취소 버튼-->
  <button onclick="Payment()">결제하기</button>
  <button onclick="Cancle()">취소하기</button>
  
 

  <script>
    // 전역 변수 : 앞 페이지 설정한 로그인 상태, 쿠폰 소유&사용 유무, 좌석정보, 이름 등을 저장.
    let selectedMovieImg = ""; 
    let selectedMovieTime = "";
    let selectedMovieInfo = "";
    let clientInfo = { adult: 1, child: 1, senior: 1 }; // 앞에서 가져올 변수 가격 적용 잘되나 보기 위해 임의 설정
    let loginStatus = true;
    let hasCoupon = true;
    let useCoupon = false;
    let movieSelected = true;
    let selectedSeatInfo = [];
    let clientName = "";
    let paymentMethod = "";

    // 총 가격, 할인 가격 저장할 변수
    let totalPrice = 0
    let discount = 0;
    
    // 가격 계산 함수
    function calPrice() {
      // 개별 요금 정의
      let adultPrice = 12000;
      let childPrice = 8000;
      let seniorPrice = 6000;

    // 총 가격 = 인원수 x 각 티켓 가격
      totalPrice = (clientInfo.adult * adultPrice) +
                   (clientInfo.child * childPrice) +
                   (clientInfo.senior * seniorPrice);

      // 금액 정보 출력
      let info = document.getElementById("info");
      info.innerHTML = `<p>총 금액: ${totalPrice}원</p>`;

      // 쿠폰 여부 확인
      if (loginStatus && hasCoupon) {
        let coupon = document.getElementById("coupon"); // 로그인 완료 + 쿠폰도 있는 경우
        coupon.innerHTML = `
          <p>할인 쿠폰이 있습니다. 적용하시겠습니까?</p>
          <button onclick="applyCoupon()">쿠폰 적용</button>
          <button onclick="skipCoupon()">적용 안함</button>
        `;
      } else {
      // 쿠폰 없을 경우 할인 없이 금액 확정
        discount = totalPrice;
      }
    }

    // 쿠폰 o 적용
    function applyCoupon() {
      useCoupon = true;
      discount = totalPrice * 0.8; // 20% 할인 예시
      newinfo(); // 할인 된 금액 다시 보여주기
    }

    // 쿠폰 스킵
    function skipCoupon() {
      useCoupon = false;
      discount = totalPrice;
      newinfo(); // 할인 없이 동일한 금액
    }

    // 할인 된 금액 표시
    function newinfo() {
      let info = document.getElementById("info");
      // 할인 금액 추가로 표시
      info.innerHTML += `<p>할인 후 금액: ${discount}원</p>`;
      
      // 쿠폰 영역 비우기
      document.getElementById("coupon").innerHTML = "";
    }

    // 결제 처리
    function Payment() {
      // 결제 수단 중 선택된 결제수단 확인
      let radios = document.getElementsByName("pay");
      for (let i = 0; i < radios.length; i++) {
        if (radios[i].checked) {
          paymentMethod = radios[i].value;
        }
      }

    // 결제 방법 고르지 않을 시 alert
      if (!paymentMethod) {
        alert("결제 방법을 선택하세요.");
        return;
      }
    // 결제완료 알림 => 다음 창 이동
      alert("결제가 완료되었습니다!");
      window.location.href = "showMovieTicket.html";
    }

    function Cancle() {
     
     // 전역 데이터 초기화
      selectedMovieImg = "";
      selectedMovieTime = "";
      selectedMovieInfo = "";
      clientInfo = { adult: 0, child: 0, senior: 0 };
      loginStatus = false;
      hasCoupon = false;
      useCoupon = false;
      movieSelected = false;
      selectedSeatInfo = [];
      clientName = "";
      paymentMethod = "";

      alert("결제가 취소되었습니다.");
      window.location.href = "selectMovie.html";
    }


    calPrice();
  </script>
</body>
</html>
